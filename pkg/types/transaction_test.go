package types

import (
	"encoding/json"
	"testing"

	"github.com/Ankr-network/uscan/pkg/field"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/stretchr/testify/assert"
)

func TestTxSerialize(t *testing.T) {
	to := common.HexToAddress("0x473780deaf4a2ac070bbba936b0cdefe7f267dfc")
	b := &Tx{
		BlockNum:  *field.NewInt(11),
		GasTipCap: *field.NewInt(11),
		GasFeeCap: *field.NewInt(11),
		GasPrice:  *field.NewInt(11),
		Nonce:     *field.NewInt(11123123),
		Gas:       *field.NewInt(123421),
		To:        &to,
		Value:     *field.NewInt(12312313),
		Data:      []byte{11, 22, 212, 4, 54, 213, 2, 41, 41, 54},

		// Signature values
		V: *field.NewInt(111),
		R: *field.NewInt(111),
		S: *field.NewInt(111),
	}

	res, err := b.Marshal()

	assert.NoError(t, err)
	t.Log(hexutil.Bytes(res).String())

	out := Tx{}

	err = out.Unmarshal(res)
	assert.NoError(t, err)

	assert.Equal(t, out.BlockNum, b.BlockNum)
	assert.Equal(t, out.GasTipCap.String(), b.GasTipCap.String())
	assert.Equal(t, out.GasFeeCap, b.GasFeeCap)
	assert.Equal(t, out.GasPrice, b.GasPrice)
	assert.Equal(t, out.Nonce, b.Nonce)
	assert.Equal(t, out.Gas, b.Gas)
	assert.Equal(t, out.To, b.To)
	assert.Equal(t, out.Value, b.Value)
	assert.Equal(t, out.V, b.V)
	assert.Equal(t, out.R, b.R)
	assert.Equal(t, out.S, b.S)
}

var testTx1 = []byte(`{"blockHash":"0x93dc24ad05a3e73bbec6d52f0991a0c8ef6560ca9257bc8f28b08ec4d5b1f643","blockNumber":"0x1fe580","from":"0x3c10ec535d1a8cba60536a963cc62a1df855e71c","gas":"0x748c","gasPrice":"0x5dc","hash":"0x9aaa0c4a421d8cd3e52765475acccb23a6dd388d0be384b00bb73fc7e8db796d","input":"0xa9059cbb0000000000000000000000008ec529c63f174996c5cf360081d94bac07a8615e00000000000000000000000000000000000000000000000000000002540be400","nonce":"0x5f","to":"0x07861819f3d9773088f67e5572bd645b2e5c15ef","transactionIndex":"0x0","value":"0x0","type":"0x0","v":"0x5e7d","r":"0x106dcc2018fbb19b93693348635c1b8f78b008778d8ef28201079ffd7789e569","s":"0x457579ddeed18c9a59ab5acd2d77c0862fc00b3e64d40af173e7e067f82a1ae4"}`)
var testTx2 = []byte(`{"blockHash":"0xcd2ff8988fbf58c9ef07a71d95d7267550bfc483f897616fbd412ce0fe7a1782","blockNumber":"0x287d10","from":"0x20cd8eb93c50bdac35d6a526f499c0104958e3f6","gas":"0x25bc62","gasPrice":"0x0","maxFeePerGas":"0x0","maxPriorityFeePerGas":"0x0","hash":"0x1ca36d27f7bbaee3bd6ce1ce74047b4142b6c5aea34ab8255a65dd977ff193d1","input":"0x608060405234801561001057600080fd5b50613040806100206000396000f3fe6080604052600436106101405760003560e01c8063715018a6116100b6578063de4db3f41161006f578063de4db3f4146103d2578063ef60741f146103f2578063f23a6e6114610412578063f2fde38b1461043f578063f583d31f1461045f578063f8c8765e1461049757600080fd5b8063715018a61461030c57806381b0e390146103215780638da5cb5b146103415780638eec5d701461035f578063a51dd75d1461037e578063ac4afa381461039e57600080fd5b80633fb7166d116101085780633fb7166d1461021e57806340e58ee514610269578063429b62e5146102895780634b0bddd2146102b9578063564d21ed146102d95780636d9a640a146102f957600080fd5b8063097eb75914610145578063150b7a02146101675780632e334452146101b1578063357b2014146101de5780633ccdbb28146101fe575b600080fd5b34801561015157600080fd5b5061016561016036600461250e565b6104b7565b005b34801561017357600080fd5b5061019361018236600461257b565b630a85bd0160e11b95945050505050565b6040516001600160e01b031990911681526020015b60405180910390f35b3480156101bd57600080fd5b506101c66104cb565b6040516001600160a01b0390911681526020016101a8565b3480156101ea57600080fd5b506067546101c6906001600160a01b031681565b34801561020a57600080fd5b506101656102193660046125ee565b6104e5565b34801561022a57600080fd5b50610259610239366004612630565b606b60209081526000928352604080842090915290825290205460ff1681565b60405190151581526020016101a8565b34801561027557600080fd5b5061016561028436600461265c565b610747565b34801561029557600080fd5b506102596102a436600461250e565b60656020526000908152604090205460ff1681565b3480156102c557600080fd5b506101656102d4366004612683565b610a0b565b3480156102e557600080fd5b506069546101c6906001600160a01b031681565b6101656103073660046126bc565b610a76565b34801561031857600080fd5b5061016561149c565b34801561032d57600080fd5b5061016561033c366004612824565b6114b0565b34801561034d57600080fd5b506033546001600160a01b03166101c6565b34801561036b57600080fd5b50606a545b6040519081526020016101a8565b34801561038a57600080fd5b506068546101c6906001600160a01b031681565b3480156103aa57600080fd5b506103be6103b936600461265c565b611826565b6040516101a89897969594939291906128d3565b3480156103de57600080fd5b506101656103ed366004612923565b61188c565b3480156103fe57600080fd5b5061016561040d3660046129ad565b61195f565b34801561041e57600080fd5b5061019361042d366004612a3f565b63f23a6e6160e01b9695505050505050565b34801561044b57600080fd5b5061016561045a36600461250e565b611a32565b34801561046b57600080fd5b5061037061047a366004612abb565b606c60209081526000928352604080842090915290825290205481565b3480156104a357600080fd5b506101656104b2366004612ae0565b611aa8565b6104bf611c02565b6104c881611c5c565b50565b60006104d5611c02565b506066546001600160a01b031690565b6104ed611c02565b600082116105335760405162461bcd60e51b815260206004820152600e60248201526d1a5b9d985a5b1908185b5bdd5b9d60921b60448201526064015b60405180910390fd5b6001600160a01b0381166105cd57814710156105915760405162461bcd60e51b815260206004820152601d60248201527f657863657373206f6620776974686472617761626c6520616d6f756e74000000604482015260640161052a565b6040516001600160a01b0384169083156108fc029084906000818181858888f193505050501580156105c7573d6000803e3d6000fd5b50505050565b6040516370a0823160e01b815230600482015282906001600160a01b038316906370a0823190602401602060405180830381865afa158015610613573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906106379190612b3c565b10156106915760405162461bcd60e51b8152602060048201526024808201527f45524332303a20657863657373206f6620776974686472617761626c6520616d6044820152631bdd5b9d60e21b606482015260840161052a565b60405163a9059cbb60e01b81526001600160a01b0384811660048301526024820184905282169063a9059cbb906044016020604051808303816000875af11580156106e0573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107049190612b55565b6107425760405162461bcd60e51b815260206004820152600f60248201526e1d1c985b9cd9995c8819985a5b1959608a1b604482015260640161052a565b505050565b3233146107665760405162461bcd60e51b815260040161052a90612b72565b606a54819081106107895760405162461bcd60e51b815260040161052a90612b9a565b336000908152606b6020908152604080832085845290915290205460ff166107c35760405162461bcd60e51b815260040161052a90612bd1565b6000606a83815481106107d8576107d8612c1a565b906000526020600020906008020190508060010160159054906101000a900460ff161561083e5760405162461bcd60e51b81526020600482015260146024820152731c1bdbdb08185b1dd85e5cc818d85b98d95b195960621b604482015260640161052a565b80600401548160030154116108805760405162461bcd60e51b81526020600482015260086024820152671cdbdb19081bdd5d60c21b604482015260640161052a565b6000600182810154600160a01b900460ff16908111156108a2576108a261289b565b0361092957806004015460000361092457600181015481546002830154604051632142170760e11b81526001600160a01b03938416936342842e0e936108f19330939290911691600401612c30565b600060405180830381600087803b15801561090b57600080fd5b505af115801561091f573d6000803e3d6000fd5b505050505b6109c4565b8060040154816003015411156109c457600181015481546002830154600484015460038501546001600160a01b039485169463f242432a94309491169290916109729190612c6a565b6040518563ffffffff1660e01b81526004016109919493929190612c81565b600060405180830381600087803b1580156109ab57600080fd5b505af11580156109bf573d6000803e3d6000fd5b505050505b60018101805460ff60a81b1916600160a81b179055604051839033907ff3a6ef5718c05d9183af076f5753197b68b04552a763c34796637d6134bdd0f290600090a3505050565b610a13611c02565b6001600160a01b038216600081815260656020908152604091829020805460ff19168515159081179091558251938452908301527f55a5194bc0174fcaf12b2978bef43911466bf63b34db8d1dd1a0d5dcd5c41bea910160405180910390a15050565b323314610a955760405162461bcd60e51b815260040161052a90612b72565b606a5483908110610ab85760405162461bcd60e51b815260040161052a90612b9a565b6000606a8581548110610acd57610acd612c1a565b906000526020600020906008020190508060010160159054906101000a900460ff1615610b335760405162461bcd60e51b81526020600482015260146024820152731c1bdbdb08185b1dd85e5cc818d85b98d95b195960621b604482015260640161052a565b8060040154816003015411610b755760405162461bcd60e51b81526020600482015260086024820152671cdbdb19081bdd5d60c21b604482015260640161052a565b8381600401548260030154610b8a9190612c6a565b1015610bd05760405162461bcd60e51b8152602060048201526015602482015274696e73756666696369656e7420746f6b656e49647360581b604482015260640161052a565b8054336001600160a01b0390911603610c2b5760405162461bcd60e51b815260206004820152601f60248201527f6e6f7420616c6c6f77656420746f2062757920796f7572206f776e206e667400604482015260640161052a565b60685460018201546002830154604051630508b99f60e31b81526001600160a01b0392831660048201526024810191909152911690632845ccf890604401602060405180830381865afa158015610c86573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610caa9190612b55565b15610ce75760405162461bcd60e51b815260206004820152600d60248201526c064697361626c6564207377617609c1b604482015260640161052a565b600080806001600160a01b038616610f8c576000846005015411610d4d5760405162461bcd60e51b815260206004820152601760248201527f6e6f7420737570706f727420636861696e20746f6b656e000000000000000000604482015260640161052a565b6000878560050154610d5f9190612cb9565b905080341015610da75760405162461bcd60e51b81526020600482015260136024820152721a5b9cdd59999a58da595b9d08185b5bdd5b9d606a1b604482015260640161052a565b606754600186015460405163eabd506b60e01b81526001600160a01b0391821660048201526024810184905291169063eabd506b90604401606060405180830381865afa158015610dfc573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610e209190612cd8565b60675492965090945092506001600160a01b031663ba6bd69a610e438587612d06565b600188015460405160e084901b6001600160e01b03191681526001600160a01b03909116600482015260248101889052604481018790526064016000604051808303818588803b158015610e9657600080fd5b505af1158015610eaa573d6000803e3d6000fd5b50505050506000821115610f1d5784546040516001600160a01b039091169083156108fc029084906000818181858888f19350505050610f1d5760405162461bcd60e51b815260206004820152600e60248201526d1c185e5b595b9d0819985a5b195960921b604482015260640161052a565b80341115610f8657336108fc610f338334612c6a565b6040518115909202916000818181858888f19350505050610f865760405162461bcd60e51b815260206004820152600d60248201526c1c99599d5b990819985a5b1959609a1b604482015260640161052a565b50611336565b6000888152606c602090815260408083206001600160a01b038a168452909152902054610ffb5760405162461bcd60e51b815260206004820152601760248201527f6e6f7420737570706f727420455243323020546f6b656e000000000000000000604482015260640161052a565b6000888152606c602090815260408083206001600160a01b038a168452909152812054611029908990612cb9565b606754600187015460405163eabd506b60e01b81526001600160a01b03918216600482015260248101849052929350169063eabd506b90604401606060405180830381865afa158015611080573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906110a49190612cd8565b919550935091506001600160a01b0387166323b872dd33306110c68789612d06565b6040518463ffffffff1660e01b81526004016110e493929190612c30565b6020604051808303816000875af1158015611103573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906111279190612b55565b6111695760405162461bcd60e51b8152602060048201526013602482015272199959481d1c985b9cd9995c8819985a5b1959606a1b604482015260640161052a565b84546040516323b872dd60e01b81526001600160a01b03808a16926323b872dd9261119c92339216908790600401612c30565b6020604051808303816000875af11580156111bb573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906111df9190612b55565b61122b5760405162461bcd60e51b815260206004820152601d60248201527f61637475616c20616d6f756e74207472616e73666572206661696c6564000000604482015260640161052a565b6067546001600160a01b038089169163095ea7b3911661124b8688612d06565b6040516001600160e01b031960e085901b1681526001600160a01b03909216600483015260248201526044016020604051808303816000875af1158015611296573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906112ba9190612b55565b506067546001860154604051631883509760e21b81526001600160a01b0391821660048201528982166024820152604481018790526064810186905291169063620d425c90608401600060405180830381600087803b15801561131c57600080fd5b505af1158015611330573d6000803e3d6000fd5b50505050505b6000600185810154600160a01b900460ff16908111156113585761135861289b565b036113cd5760018401546002850154604051632142170760e11b81526001600160a01b03909216916342842e0e916113969130913391600401612c30565b600060405180830381600087803b1580156113b057600080fd5b505af11580156113c4573d6000803e3d6000fd5b5050505061143b565b60018401546002850154604051637921219560e11b81526001600160a01b039092169163f242432a9161140891309133918d90600401612c81565b600060405180830381600087803b15801561142257600080fd5b505af1158015611436573d6000803e3d6000fd5b505050505b86846004015461144b9190612d06565b60048501556040516001600160a01b03871681528790899033907f50994f8bcf54474cf3e35793e3537d1f44ec39d92f19a3d7a01b36723b886fc09060200160405180910390a45050505050505050565b6114a4611c02565b6114ae6000611c7e565b565b3233146114cf5760405162461bcd60e51b815260040161052a90612b72565b606a54849081106114f25760405162461bcd60e51b815260040161052a90612b9a565b336000908152606b6020908152604080832088845290915290205460ff1661152c5760405162461bcd60e51b815260040161052a90612bd1565b6000606a868154811061154157611541612c1a565b9060005260206000209060080201905060005b60068201548110156115be576000878152606c602052604081206006840180549192918490811061158757611587612c1a565b60009182526020808320909101546001600160a01b03168352820192909252604001812055806115b681612d1e565b915050611554565b5060005b84518110156117ac5760695485516001600160a01b03909116906345faa9c9908790849081106115f4576115f4612c1a565b60200260200101516040518263ffffffff1660e01b815260040161162791906001600160a01b0391909116815260200190565b602060405180830381865afa158015611644573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906116689190612b55565b6116845760405162461bcd60e51b815260040161052a90612d37565b600084828151811061169857611698612c1a565b6020026020010151116116bd5760405162461bcd60e51b815260040161052a90612d7a565b606c600088815260200190815260200160002060008683815181106116e4576116e4612c1a565b60200260200101516001600160a01b03166001600160a01b031681526020019081526020016000205460001461172c5760405162461bcd60e51b815260040161052a90612dcd565b83818151811061173e5761173e612c1a565b6020026020010151606c6000898152602001908152602001600020600087848151811061176d5761176d612c1a565b60200260200101516001600160a01b03166001600160a01b031681526020019081526020016000208190555080806117a490612d1e565b9150506115c2565b5083516117c29060068301906020870190612444565b5082516117d890600783019060208601906124a9565b50600581018590556040517f9e75ddf5eab94f4c25122bf07ecfe8a6d0739c9bce50f892e4115a084312300290611816908890889088908890612e4c565b60405180910390a1505050505050565b606a818154811061183657600080fd5b60009182526020909120600890910201805460018201546002830154600384015460048501546005909501546001600160a01b0394851696509383169460ff600160a01b8504811695600160a81b909504169388565b6040516301ffc9a760e01b81526380ac58cd60e01b60048201526001600160a01b038616906301ffc9a790602401602060405180830381865afa1580156118d7573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906118fb9190612b55565b6119475760405162461bcd60e51b815260206004820152601760248201527f696e7661696c642045524337323120636f6e7472616374000000000000000000604482015260640161052a565b611958856000866001878787611cd0565b5050505050565b6040516301ffc9a760e01b8152636cdb3d1360e11b60048201526001600160a01b038716906301ffc9a790602401602060405180830381865afa1580156119aa573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906119ce9190612b55565b611a1a5760405162461bcd60e51b815260206004820152601860248201527f696e7661696c64204552433131353520636f6e74726163740000000000000000604482015260640161052a565b611a2a8660018787878787611cd0565b505050505050565b611a3a611c02565b6001600160a01b038116611a9f5760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b606482015260840161052a565b6104c881611c7e565b600054610100900460ff1615808015611ac85750600054600160ff909116105b80611ae25750303b158015611ae2575060005460ff166001145b611b455760405162461bcd60e51b815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201526d191e481a5b9a5d1a585b1a5e995960921b606482015260840161052a565b6000805460ff191660011790558015611b68576000805461ff0019166101001790555b611b706123ea565b606780546001600160a01b038088166001600160a01b031992831617909255606880548784169083161790556069805492861692909116919091179055611bb682611c5c565b8015611958576000805461ff0019169055604051600181527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15050505050565b6033546001600160a01b031633146114ae5760405162461bcd60e51b815260206004820181905260248201527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604482015260640161052a565b606680546001600160a01b0319166001600160a01b0392909216919091179055565b603380546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b323314611cef5760405162461bcd60e51b815260040161052a90612b72565b606854604051630508b99f60e31b81526001600160a01b03808a1660048301526024820188905289928892911690632845ccf890604401602060405180830381865afa158015611d43573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611d679190612b55565b15611da35760405162461bcd60e51b815260206004820152600c60248201526b191a5cd8589b19590813999d60a21b604482015260640161052a565b6001600160a01b038916611df05760405162461bcd60e51b815260206004820152601460248201527320696e7661696c64206e6674206164647265737360601b604482015260640161052a565b6001861015611e415760405162461bcd60e51b815260206004820152601f60248201527f7175616e74697479206d7573742062652067726561746572207468616e203000604482015260640161052a565b8251845114611e925760405162461bcd60e51b815260206004820152601b60248201527f5f73656c6c457263323073206c656e677468206d69736d617463680000000000604482015260640161052a565b611eea6040805161014081018252600080825260208201819052909182019081526020016000151581526020016000815260200160008152602001600081526020016000815260200160608152602001606081525090565b3381526001600160a01b038a16602082015260408101896001811115611f1257611f1261289b565b90816001811115611f2557611f2561289b565b9052506000606082018190526080820189905260a0820188905260c0820181905260e08201879052606a54905b865181101561213c5760695487516001600160a01b03909116906345faa9c990899084908110611f8457611f84612c1a565b60200260200101516040518263ffffffff1660e01b8152600401611fb791906001600160a01b0391909116815260200190565b602060405180830381865afa158015611fd4573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611ff89190612b55565b6120145760405162461bcd60e51b815260040161052a90612d37565b600086828151811061202857612028612c1a565b60200260200101511161204d5760405162461bcd60e51b815260040161052a90612d7a565b606c6000838152602001908152602001600020600088838151811061207457612074612c1a565b60200260200101516001600160a01b03166001600160a01b03168152602001908152602001600020546000146120bc5760405162461bcd60e51b815260040161052a90612dcd565b8581815181106120ce576120ce612c1a565b6020026020010151606c600084815260200190815260200160002060008984815181106120fd576120fd612c1a565b60200260200101516001600160a01b03166001600160a01b0316815260200190815260200160002081905550808061213490612d1e565b915050611f52565b506101008201869052610120820185905260008a60018111156121615761216161289b565b036121cd57604051632142170760e11b81526001600160a01b038c16906342842e0e9061219690339030908e90600401612c30565b600060405180830381600087803b1580156121b057600080fd5b505af11580156121c4573d6000803e3d6000fd5b50505050612232565b604051637921219560e11b81526001600160a01b038c169063f242432a906121ff90339030908e908e90600401612c81565b600060405180830381600087803b15801561221957600080fd5b505af115801561222d573d6000803e3d6000fd5b505050505b606a80546001808201835560009290925283517f116fea137db6e131133e7f2bab296045d8f41cc5607279db17b218cab0929a51600890920291820180546001600160a01b03199081166001600160a01b0393841617825560208701517f116fea137db6e131133e7f2bab296045d8f41cc5607279db17b218cab0929a5290940180549182169490931693841783556040870151879592949093926001600160a81b03199092161790600160a01b9084908111156122f2576122f261289b565b02179055506060820151600182018054911515600160a81b0260ff60a81b199092169190911790556080820151600282015560a0820151600382015560c0820151600482015560e08201516005820155610100820151805161235e916006840191602090910190612444565b50610120820151805161237b9160078401916020909101906124a9565b5050336000818152606b6020908152604080832086845290915290819020805460ff19166001179055518392507f3a01e63d44c65e2068a3b07155d09952567228f8f1d104ecb6e9d8266d34b252906123d5908690612ef6565b60405180910390a35050505050505050505050565b600054610100900460ff166124115760405162461bcd60e51b815260040161052a90612fbf565b6114ae600054610100900460ff1661243b5760405162461bcd60e51b815260040161052a90612fbf565b6114ae33611c7e565b828054828255906000526020600020908101928215612499579160200282015b8281111561249957825182546001600160a01b0319166001600160a01b03909116178255602090920191600190910190612464565b506124a59291506124e4565b5090565b828054828255906000526020600020908101928215612499579160200282015b828111156124995782518255916020019190600101906124c9565b5b808211156124a557600081556001016124e5565b6001600160a01b03811681146104c857600080fd5b60006020828403121561252057600080fd5b813561252b816124f9565b9392505050565b60008083601f84011261254457600080fd5b50813567ffffffffffffffff81111561255c57600080fd5b60208301915083602082850101111561257457600080fd5b9250929050565b60008060008060006080868803121561259357600080fd5b853561259e816124f9565b945060208601356125ae816124f9565b935060408601359250606086013567ffffffffffffffff8111156125d157600080fd5b6125dd88828901612532565b969995985093965092949392505050565b60008060006060848603121561260357600080fd5b833561260e816124f9565b9250602084013591506040840135612625816124f9565b809150509250925092565b6000806040838503121561264357600080fd5b823561264e816124f9565b946020939093013593505050565b60006020828403121561266e57600080fd5b5035919050565b80151581146104c857600080fd5b6000806040838503121561269657600080fd5b82356126a1816124f9565b915060208301356126b181612675565b809150509250929050565b6000806000606084860312156126d157600080fd5b83359250602084013591506040840135612625816124f9565b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f1916810167ffffffffffffffff81118282101715612729576127296126ea565b604052919050565b600067ffffffffffffffff82111561274b5761274b6126ea565b5060051b60200190565b600082601f83011261276657600080fd5b8135602061277b61277683612731565b612700565b82815260059290921b8401810191818101908684111561279a57600080fd5b8286015b848110156127be5780356127b1816124f9565b835291830191830161279e565b509695505050505050565b600082601f8301126127da57600080fd5b813560206127ea61277683612731565b82815260059290921b8401810191818101908684111561280957600080fd5b8286015b848110156127be578035835291830191830161280d565b6000806000806080858703121561283a57600080fd5b8435935060208501359250604085013567ffffffffffffffff8082111561286057600080fd5b61286c88838901612755565b9350606087013591508082111561288257600080fd5b5061288f878288016127c9565b91505092959194509250565b634e487b7160e01b600052602160045260246000fd5b600281106128cf57634e487b7160e01b600052602160045260246000fd5b9052565b6001600160a01b0389811682528816602082015261010081016128f960408301896128b1565b9515156060820152608081019490945260a084019290925260c083015260e0909101529392505050565b600080600080600060a0868803121561293b57600080fd5b8535612946816124f9565b94506020860135935060408601359250606086013567ffffffffffffffff8082111561297157600080fd5b61297d89838a01612755565b9350608088013591508082111561299357600080fd5b506129a0888289016127c9565b9150509295509295909350565b60008060008060008060c087890312156129c657600080fd5b86356129d1816124f9565b9550602087013594506040870135935060608701359250608087013567ffffffffffffffff80821115612a0357600080fd5b612a0f8a838b01612755565b935060a0890135915080821115612a2557600080fd5b50612a3289828a016127c9565b9150509295509295509295565b60008060008060008060a08789031215612a5857600080fd5b8635612a63816124f9565b95506020870135612a73816124f9565b94506040870135935060608701359250608087013567ffffffffffffffff811115612a9d57600080fd5b612aa989828a01612532565b979a9699509497509295939492505050565b60008060408385031215612ace57600080fd5b8235915060208301356126b1816124f9565b60008060008060808587031215612af657600080fd5b8435612b01816124f9565b93506020850135612b11816124f9565b92506040850135612b21816124f9565b91506060850135612b31816124f9565b939692955090935050565b600060208284031215612b4e57600080fd5b5051919050565b600060208284031215612b6757600080fd5b815161252b81612675565b6020808252600e908201526d34b73b30b4b6321031b0b63632b960911b604082015260600190565b60208082526018908201527f7468697320706f6f6c20646f6573206e6f742065786973740000000000000000604082015260600190565b60208082526029908201527f63616e27742062652063616e63656c6c656420626563617573652069742773206040820152686e6f7420796f75727360b81b606082015260800190565b634e487b7160e01b600052603260045260246000fd5b6001600160a01b039384168152919092166020820152604081019190915260600190565b634e487b7160e01b600052601160045260246000fd5b600082821015612c7c57612c7c612c54565b500390565b6001600160a01b0394851681529290931660208301526040820152606081019190915260a06080820181905260009082015260c00190565b6000816000190483118215151615612cd357612cd3612c54565b500290565b600080600060608486031215612ced57600080fd5b8351925060208401519150604084015190509250925092565b60008219821115612d1957612d19612c54565b500190565b600060018201612d3057612d30612c54565b5060010190565b60208082526023908201527f455243323020746f6b656e206973206e6f7420616c6c6f7720746f20627579206040820152621b999d60ea1b606082015260800190565b60208082526033908201527f455243323020746f6b656e20616d6f756e74206d7573742067726561746572206040820152721d1a185b880c08199bdc881cd95b1b081b999d606a1b606082015260800190565b60208082526024908201527f6475706c696361746520657263323020746f6b656e20696e205f73656c6c45726040820152636332307360e01b606082015260800190565b600081518084526020808501945080840160005b83811015612e4157815187529582019590820190600101612e25565b509495945050505050565b600060808201868352602086818501526080604085015281865180845260a086019150828801935060005b81811015612e9c5784516001600160a01b031683529383019391830191600101612e77565b50508481036060860152612eb08187612e11565b9998505050505050505050565b600081518084526020808501945080840160005b83811015612e415781516001600160a01b031687529582019590820190600101612ed1565b60208152612f106020820183516001600160a01b03169052565b60006020830151612f2c60408401826001600160a01b03169052565b506040830151612f3f60608401826128b1565b506060830151801515608084015250608083015160a083015260a083015160c083015260c083015160e083015260e08301516101008181850152808501519150506101406101208181860152612f99610160860184612ebd565b90860151858203601f190183870152909250612fb58382612e11565b9695505050505050565b6020808252602b908201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960408201526a6e697469616c697a696e6760a81b60608201526080019056fea26469706673582212208255c0634e27e53008c059b000dbe5d8dc861903c5eb8a4a3df9cdab6e47fc9f64736f6c634300080e0033","nonce":"0x1a9","to":null,"transactionIndex":"0x0","value":"0x0","type":"0x2","accessList":[],"chainId":"0x2f2d","v":"0x0","r":"0xbb5d277d441efe20db33faefb0824ae36a5155e087660dd919b79cc50201fb94","s":"0x362cb8a6ecc3952418de1bd140ecb7533530f2a9e517351d3b6e80df8aa20111"}`)

func TestTx1Json(t *testing.T) {
	out := &Tx{}
	err := json.Unmarshal(testTx1, out)
	assert.NoError(t, err)
	t.Log(out)

	byteRes, err := json.Marshal(out)
	assert.NoError(t, err)
	t.Log(string(byteRes))

	res, err := out.Marshal()
	assert.NoError(t, err)
	data := &Tx{}
	err = data.Unmarshal(res)
	assert.NoError(t, err)
	t.Log(data)

}

func TestTx2Json(t *testing.T) {
	out := &Tx{}
	err := json.Unmarshal(testTx2, out)
	if out.To == nil {
		out.To = &common.Address{}
	}
	assert.NoError(t, err)
	t.Log(out)

	byteRes, err := json.Marshal(out)
	assert.NoError(t, err)
	t.Log(string(byteRes))

	res, err := out.Marshal()
	assert.NoError(t, err)
	data := &Tx{}
	err = data.Unmarshal(res)
	assert.NoError(t, err)
	t.Log(data)
}
